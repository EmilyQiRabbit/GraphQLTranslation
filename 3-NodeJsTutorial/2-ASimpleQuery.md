> * åŸæ–‡åœ°å€ï¼š[A Simple Query](https://www.howtographql.com/graphql-js/2-a-simple-query/)
> * è¯‘æ–‡æ¥è‡ªï¼š[Github:EmilyQiRabbit](https://github.com/EmilyQiRabbit/GraphQLTranslation)
> * è¯‘è€…ï¼š[YuqiğŸŒ¸](https://github.com/EmilyQiRabbit)
> * **æ¬¢è¿æ ¡å¯¹** ğŸ™‹â€â™€ï¸ğŸ‰

# Query åŸºç¡€

åœ¨æœ¬ç¯‡æ•™ç¨‹ä¸­ï¼Œæˆ‘ä»¬å°†ä¼šå®ç°ç¬¬ä¸€ä¸ª API æ“ä½œï¼Œå®ƒå¯ä»¥ä¸ºå…‹éš†ç‰ˆçš„ Hacker News ç½‘ç«™æä¾›å¯ä»¥ç”¨æ¥æŸ¥è¯¢æˆ·åˆ›å»ºçš„æ–°é—»é“¾æ¥çš„æ¥å£ã€‚

## æ‰©å±•æ¨¡å¼å®šä¹‰

æˆ‘ä»¬ä»å®ç° feed query å¼€å§‹ï¼Œè¿™ä¸ªæ¥å£å¯ä»¥è¿”å› List ç±»å‹å…ƒç´ çš„åˆ—è¡¨ã€‚ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œä¸º API æ·»åŠ æ–°åŠŸèƒ½çš„è¿‡ç¨‹éƒ½å¾ˆç›¸ä¼¼ï¼š

1. ä¸º GraphQL æ¨¡å¼å®šä¹‰æ‰©å±•æ–°çš„æ ¹å­—æ®µï¼ˆå¦‚æœéœ€è¦ï¼Œä¹Ÿè¦æ·»åŠ ç›¸å…³è”çš„æ•°æ®ç±»å‹ï¼‰

2. ä¸ºæ–°å¢å­—æ®µæ·»åŠ ä¸ä¹‹ç›¸å…³çš„ resolver å‡½æ•°ã€‚

è¿™ä¸ªè¿‡ç¨‹ä¹Ÿç§°ä¸ºæ¨¡å¼é©±åŠ¨ï¼ˆschema-drivenï¼‰æˆ–è€…æ¨¡å¼ä¼˜å…ˆï¼ˆschema-firstï¼‰å¼€å‘ã€‚

ä¸‹é¢æˆ‘ä»¬æ¥å®Œæˆç¬¬ä¸€æ­¥ï¼šæ‰©å±• GraphQL æ¨¡å¼å®šä¹‰ã€‚

åœ¨ [index.js](https://github.com/howtographql/graphql-js/blob/master/src/index.js) æ–‡ä»¶ä¸­ï¼Œæ›´æ–° typeDefs å¸¸é‡ï¼š

```js
const typeDefs = `
type Query {
  info: String!
  feed: [Link!]!
}

type Link {
  id: ID!
  description: String!
  url: String!
}
`
```

ä»£ç ç®€å•ç›´è§‚ï¼šæ–°å®šä¹‰äº† Link ç±»å‹ï¼Œå®ƒä»£è¡¨ Hacker News åº”ç”¨ä¸­çš„æ–°é—»é“¾æ¥ã€‚æ¯ä¸ª Link éƒ½æœ‰ id, description å’Œ url å±æ€§ã€‚æ¥ä¸‹æ¥ï¼Œä¸º Query æ·»åŠ ä¸€ä¸ªæ ¹å­—æ®µ feedï¼Œå…è®¸ç”¨æˆ·è·å– Link å…ƒç´ çš„åˆ—è¡¨ã€‚è¿™ä¸ªåˆ—è¡¨ä¸èƒ½æ˜¯ç©ºï¼Œå¹¶ä¸”ä¹Ÿä¸èƒ½åŒ…å«ç©ºå…ƒç´  â€”â€” è¿™æ˜¯ `[Link!]!` ä¸­ä¸¤ä¸ª `!` çš„ä½œç”¨ã€‚

## å®ç° resolver å‡½æ•°

ä¸‹ä¸€æ­¥æ˜¯å®ç° feed å¯¹åº”çš„ resolver å‡½æ•°ã€‚äº‹å®ä¸Šæœ‰ä¸€ç‚¹æˆ‘ä»¬è¿˜æœªæ›¾æåŠï¼šä¸ä»…ä»…æ˜¯æ ¹å­—æ®µï¼ŒGraphQL æ¨¡å¼ä¸­æ‰€æœ‰å­—æ®µéƒ½æœ‰ä¸ä¹‹ç›¸å…³çš„ resolver å‡½æ•°ã€‚æ‰€ä»¥ä½ ä¸ä»…éœ€è¦ä¸º Link ç±»å‹æ·»åŠ  resolver å‡½æ•°ï¼Œä¹Ÿè¦ä¸º id, description å’Œ url å­—æ®µéƒ½æ·»åŠ  resolver å‡½æ•°ã€‚

åœ¨ index.js ä¸­ï¼Œæ·»åŠ ä¸€ä¸ªå‡çš„æ•°æ®åˆ—è¡¨ linksï¼Œç„¶åæ›´æ–° resolverï¼š

```js
// 1
let links = [{
  id: 'link-0',
  url: 'www.howtographql.com',
  description: 'Fullstack tutorial for GraphQL'
}]

const resolvers = {
  Query: {
    info: () => `This is the API of a Hackernews Clone`,
    // 2
    feed: () => links,
  },
  // 3
  Link: {
    id: (root) => root.id,
    description: (root) => root.description,
    url: (root) => root.url,
  }
}
```

æˆ‘ä»¬æŒ‰ç…§æ³¨é‡Šä¸­çš„æ ‡å·ä¾æ¬¡è§£é‡Šè¿™æ®µä»£ç ï¼š

1. links å˜é‡ç”¨æ¥åœ¨è¿è¡Œæ—¶æš‚å­˜æ–°é—»é“¾æ¥ä¿¡æ¯ã€‚ç›®å‰è¿™äº›ä¿¡æ¯æ²¡æœ‰å­˜å‚¨åœ¨æ•°æ®åº“é‡Œï¼Œåªèƒ½åœ¨è¿è¡Œæ—¶è®¿é—®ã€‚

2. ä¸ºæ ¹å­—æ®µ feed æ·»åŠ  resolver å‡½æ•°ã€‚æˆ‘ä»¬æ³¨æ„åˆ°ï¼Œresolver å‡½æ•°å¿…é¡»ä»¥æ¨¡å¼å®šä¹‰ä¸­çš„ç›¸åº”å­—æ®µå‘½åã€‚

3. æœ€åä¸ºæ¨¡å¼å®šä¹‰ä¸­çš„ Link ç±»å‹æ·»åŠ å¦å¤–ä¸‰ä¸ª resolverã€‚æˆ‘ä»¬åé¢ä¼šè®¨è®ºè¿™é‡Œçš„å‚æ•° root æ˜¯ä»€ä¹ˆã€‚

å¯åŠ¨æœåŠ¡ç„¶åæµ‹è¯•ä¸€ä¸‹å§,ï¼ˆé¦–å…ˆä½¿ç”¨ CTRL+C åœæ­¢æ­£åœ¨è¿è¡Œçš„æœåŠ¡ï¼Œç„¶åå†æ¬¡è¿è¡Œ node src/index.jsï¼‰åœ¨æµè§ˆå™¨æ‰“å¼€` http://localhost:4000`ã€‚äºæ­¤åŒæ—¶ï¼Œåœ¨ Playground ä¸­ï¼Œå¯ä»¥çœ‹åˆ° feed è¯·æ±‚å·²ç»å¯ç”¨äº†ï¼

è¯•è¯•çœ‹å§ï¼Œå‘é€è¯·æ±‚ï¼š

```graphql
query {
  feed {
    id
    url
    description
  }
}
```

ç‚’é¸¡æ£’ï¼Œå¯ä»¥çœ‹åˆ°æœåŠ¡ç«¯è¿”å›äº† links å˜é‡å¯¹åº”çš„åˆ—è¡¨ï¼š

```graphql
{
  "data": {
    "feed": [
      {
        "id": "link-0",
        "url": "www.howtographql.com",
        "description": "Fullstack tutorial for GraphQL"
      }
    ]
  }
}
```

å¯ä»¥åˆ æ‰ query ä¸­å¯é€‰é›†åˆçš„å­—æ®µï¼ˆidï¼Œurl æˆ–è€… descriptionï¼‰ï¼Œçœ‹çœ‹æœåŠ¡ç«¯è¿”å›çš„æ•°æ®æœ‰ä»€ä¹ˆå˜åŒ–ã€‚

## query çš„è§£æè¿‡ç¨‹

ç°åœ¨æˆ‘ä»¬ç®€å•ä»‹ç»ä¸€ä¸‹ï¼ŒGraphQL æœåŠ¡å™¨æ˜¯å¦‚ä½•è§£æè¯·æ±‚çš„ã€‚å¦‚ä½ æ‰€è§ï¼ŒGraphQL è¯·æ±‚ä¼šåŒ…å«ä¸€äº›å­—æ®µï¼Œè€Œè¿™äº›å­—æ®µåœ¨ GraphQL æ¨¡å¼çš„ç±»å‹å®šä¹‰ä¸­ï¼Œéƒ½æœ‰å¯¹åº”çš„æºã€‚

æˆ‘ä»¬é‡æ–°æ€è€ƒè¿™ä¸ªè¯·æ±‚ï¼š

```graphql
query {
  feed {
    id
    url
    description
  }
}
```

æ‰€æœ‰çš„ 4 ä¸ªå­—æ®µï¼šfeed, id, url å’Œ description éƒ½èƒ½åœ¨ GraphQL æ¨¡å¼å®šä¹‰ä¸­æ‰¾åˆ°ã€‚æˆ‘ä»¬å‰é¢æåˆ°è¿‡ï¼Œæ¨¡å¼ä¸­çš„æ¯ä¸ªå­—æ®µéƒ½æœ‰ä¸€ä¸ª resolver å‡½æ•°æ”¯æŒï¼Œè¯¥ resolver å‡½æ•°å°±è´Ÿè´£è¿”å›è¿™ä¸ªå­—æ®µå¯¹åº”çš„çš„æ•°æ®ã€‚

ç°åœ¨ä½ èƒ½æƒ³è±¡å‡ºè§£æè¿‡ç¨‹æ˜¯ä»€ä¹ˆæ ·çš„äº†å—ï¼ŸGraphQL æœåŠ¡æ‰€è¦åšçš„ä¸€åˆ‡å°±æ˜¯ï¼Œè§¦å‘è¯·æ±‚ä¸­æ‰€æœ‰ field å¯¹åº”çš„ resolver å‡½æ•°ï¼Œç„¶åå§ç»“æœæ‰“åŒ…æˆè¯·æ±‚éœ€è¦çš„æ ¼å¼ã€‚è¯·æ±‚çš„è§£æå…¶å®å°±æ˜¯æŒ‰éœ€è§¦å‘ resolver å‡½æ•°çš„è¿‡ç¨‹ã€‚

ä¸‹é¢ï¼Œä»…å‰©çš„é—®é¢˜å°±æ˜¯ Link ç±»å‹çš„ resolver å‡½æ•°ï¼Œå®ƒä»¬ä¼¼ä¹éƒ½éµå¾ªä¸€ä¸ªç®€å•çš„æ¨¡ç‰ˆï¼š

```graphql
Link: {
  id: (parent) => parent.id,
  description: (parent) => parent.description,
  url: (parent) => parent.url,
}
```

é¦–å…ˆå¾ˆé‡è¦çš„ä¸€ç‚¹æ˜¯ï¼Œå®é™…æ¯ä¸ª resolver å‡½æ•°éƒ½èƒ½æ¥å— 4 ä¸ªå‚æ•°ã€‚ç”±äºåä¸‰ä¸ªç›®å‰æˆ‘ä»¬è¿˜ä¸éœ€è¦ï¼Œæ‰€ä»¥æš‚æ—¶çœç•¥ã€‚åˆ«æ‹…å¿ƒï¼Œåœ¨åç»­çš„æ–‡ç« ä¸­æˆ‘ä»¬å¾ˆå¿«å°±ä¼šå­¦åˆ°ã€‚

ç¬¬ä¸€ä¸ªå‚æ•°ï¼Œä¸€èˆ¬ç§°ä¸º `parent`ï¼ˆæˆ–è€… `root`ï¼‰ï¼Œå®ƒæ˜¯ä¸Šçº§ resolver å‡½æ•°æ‰§è¡Œçš„ç»“æœã€‚é‚£è¿™åˆæ„å‘³ç€ä»€ä¹ˆï¼ŸğŸ¤”

æˆ‘ä»¬çŸ¥é“ï¼ŒGraphQL è¯·æ±‚æ˜¯å¯ä»¥åµŒå¥—çš„ã€‚æ¯ä¸€å±‚çš„åµŒå¥—éƒ½å°±å¯¹åº”ç€ä¸€ä¸ª resolver å‡½æ•°æ‰§è¡Œå±‚ã€‚å› æ­¤ï¼Œä¸Šé¢çš„é‚£ä¸ª query æ˜¯ä¸¤å±‚çš„ã€‚

ç¬¬ä¸€å±‚è§¦å‘äº† feed resolver å‡½æ•°ï¼Œè¿”å›äº† links å˜é‡å¯¹åº”çš„æ•°æ®ã€‚åœ¨ç¬¬äºŒå±‚ï¼ŒGraphQL æœåŠ¡èƒ½å¤Ÿè‡ªåŠ¨çš„è§¦å‘ Link ç±»å‹å¯¹åº”çš„ resolverï¼ˆè¿™æ˜¯ç”±äºæœ‰äº†æ¨¡å¼ï¼ŒæœåŠ¡çŸ¥é“ feed åº”è¯¥è¿”å› Link ç±»å‹çš„å…ƒç´ ï¼‰ï¼Œå› ä¸ºåˆ—è¡¨ä¸­æ¯ä¸ªå…ƒç´ éƒ½æ˜¯ä¸Šä¸€å±‚ resolver å‡½æ•°è¿”å›çš„ï¼Œå› æ­¤ï¼Œè¿™ä¸‰ä¸ª Link ç±»å‹ resolver å‡½æ•°ä¸­ï¼Œä¼ å…¥çš„ parent å¯¹è±¡å°±æ˜¯ links åˆ—è¡¨ä¸­çš„å…ƒç´ ã€‚

> [æˆ³è¿™é‡Œæœ‰è¯¦ç»†ä»‹ç»](https://blog.graph.cool/graphql-server-basics-the-schema-ac5e2950214e#9d03)ã€‚

åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼ŒLink ä¸­çš„ resolver å‡½æ•°å…¶å®å®Œå…¨å¯ä»¥çœç•¥ ğŸ‘Œã€‚å»æ‰å®ƒä»¬ä¹Ÿä¸ä¼šå½±å“æœåŠ¡çš„è¿è¡Œã€‚
