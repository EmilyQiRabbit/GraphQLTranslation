> * åŸæ–‡åœ°å€ï¼š[Adding a Database](https://www.howtographql.com/graphql-js/4-adding-a-database/)
> * è¯‘æ–‡æ¥è‡ªï¼š[Github:EmilyQiRabbit](https://github.com/EmilyQiRabbit/GraphQLTranslation)
> * è¯‘è€…ï¼š[æ—ºè´¢](https://github.com/EmilyQiRabbit)
> * **Proofreading is welcomed** ğŸ™‹ ğŸ‰

# æ·»åŠ æ•°æ®åº“

åœ¨è¿™ä¸€éƒ¨åˆ†ï¼Œä½ å°†ä¼šå»ºç«‹èµ· Prisma æœåŠ¡ä»¥åŠæœåŠ¡è¿æ¥çš„æ•°æ®åº“ã€‚

## ä¸ºä»€ä¹ˆé€‰æ‹© Prisma

ç›®å‰ä¸ºæ­¢ï¼Œä½ å·²ç»çŸ¥é“äº† GraphQL æœåŠ¡çš„åŸºæœ¬åŸç†ï¼Œéå¸¸ç®€å•çš„æ˜¯å§ï¼Ÿè¿™æ­£æ˜¯ GraphQL ç¾å¥½ä¹‹å¤„ï¼Œåªéœ€è¦éµå¾ªç®€å•å‡ æ¡è§„åˆ™ã€‚å¼ºç±»å‹æ¨¡å¼çš„ schema å’Œèƒ½ resolve query çš„ GraphQL å¼•æ“ï¼Œé¿å…äº† API å¼€å‘ä¸­çš„å¸¸è§ç—›ç‚¹ã€‚

æ¥ä¸‹æ¥ï¼Œæ„å»º GraphQL æœåŠ¡çš„éš¾ç‚¹åœ¨å“ªé‡Œå‘¢ï¼Ÿ

åœ¨å®é™…åº”ç”¨ä¸­ï¼Œä½ å¯èƒ½ä¼šé‡åˆ°å¾ˆå¤šæƒ…å¢ƒï¼šè¿™äº›æƒ…å¢ƒä¸‹ï¼Œresolver çš„å®ç°å¯èƒ½ä¼šéå¸¸å¤æ‚ã€‚å°¤å…¶æ˜¯ GraphQL çš„è¯·æ±‚å¯èƒ½ä¼šæœ‰å¾ˆæ·±çš„åµŒå¥—ã€é‚£ä¹ˆ resolver çš„å®ç°å¯èƒ½å°±ä¼šæ¯”è¾ƒ trickyï¼Œä¹Ÿå®¹æ˜“å¯¼è‡´æ€§èƒ½é—®é¢˜ã€‚

å¤§å¤šæ•°æ—¶å€™ï¼Œä½ ç»å¸¸è¿˜éœ€è¦è€ƒè™‘å…¶ä»–å¾ˆå¤šé™„åŠ çš„å·¥ä½œæµï¼Œæ¯”å¦‚è®¤è¯ã€æƒé™ã€åˆ†é¡µã€è¿‡æ»¤æ“ä½œã€å®æ—¶å’Œç¬¬ä¸‰æ–¹çš„æœåŠ¡æˆ–è€…é—ç•™çš„æœåŠ¡æ•´åˆç­‰ç­‰ã€‚

é€šå¸¸ï¼Œå½“å®ç° resolver å¹¶è¿æ¥æ•°æ®åº“çš„æ—¶å€™ï¼Œä½ æœ‰ä¸¤ä¸ªé€‰æ‹©ã€ä½†æ˜¯è¿™ä¸¤ä¸ªéƒ½ä¸å¾ˆå®Œç¾ï¼š

1. ç›´æ¥è¿æ¥æ•°æ®åº“ï¼ˆå†™ SQL æˆ–è€…ç”¨å…¶ä»–é SQL æ•°æ®åº“ APIï¼‰ã€‚

2. ä½¿ç”¨ ORMï¼ˆObject-relational mappingï¼‰ï¼Œå®ƒå¯ä»¥æä¾›æ•°æ®åº“æ‘˜è¦ï¼Œè®©ä½ èƒ½å¤Ÿç›´æ¥ä»ä»£ç ä¸­è®¿é—®ã€‚

ç¬¬ä¸€ä¸ªæ–¹æ¡ˆæ˜¯å­˜åœ¨é—®é¢˜çš„ï¼Œå› ä¸ºåœ¨ resolver ä¸­ç›´æ¥å¤„ç† SQL éå¸¸å¤æ‚ï¼Œå¾ˆå®¹æ˜“å°±ä¼šæŠŠä»£ç æå¾—éš¾ä»¥ç»´æŠ¤ã€‚å¦ä¸€ä¸ªé—®é¢˜æ˜¯ï¼ŒSQL è¯·æ±‚ç»å¸¸æ˜¯ä»¥å­—ç¬¦ä¸²çš„å½¢å¼æäº¤åˆ°æ•°æ®åº“ã€‚å­—ç¬¦ä¸²æ²¡æœ‰ä»»ä½•ç»“æ„å¯è¨€ï¼Œå®ƒä»¬å°±æ˜¯ä¸€ç³»åˆ—å­—ç¬¦ã€‚æ‰€ä»¥ï¼Œä½ çš„å·¥å…·æ²¡åŠæ³•å¸®ä½ å‘ç°ä»£ç ä¸­å¯èƒ½çš„é”™è¯¯ï¼Œä¹Ÿæ²¡åŠæ³•æä¾›åƒè‡ªåŠ¨å¡«å……è¿™æ ·çš„é™„åŠ åŠŸèƒ½ã€‚é‚£ä¹ˆè¿™æ ·ï¼Œå†™ SQL è¯­å¥å°±éå¸¸æ£˜æ‰‹ã€éå¸¸å®¹æ˜“å‡ºé”™ã€‚

ç¬¬äºŒä¸ªæ–¹æ¡ˆä½¿ç”¨äº† ORMï¼Œå¯èƒ½ä½ ä¼šè§‰å¾—æ˜¯ä¸ªä¸é”™çš„é€‰æ‹©ã€‚ä½†æ˜¯ï¼Œè¿™ä¸ªæ–¹æ¡ˆä¹Ÿæœ‰è‡´å‘½ç¼ºç‚¹ã€‚ORMs é€šå¸¸å­˜åœ¨è¿™æ ·çš„é—®é¢˜ï¼šå®ƒæ˜¯å®ç°ç›¸å¯¹ç®€å•çš„æ•°æ®åº“è®¿é—®çš„è§£å†³æ–¹æ¡ˆï¼Œä½†æ˜¯ç”±äº GraphQL æŸ¥è¯¢çš„å¤æ‚æ€§ä»¥åŠå¯èƒ½å‡ºç°çš„å„ç§è¾¹ç•Œæƒ…å†µï¼Œæ‰€ä»¥ä½¿ç”¨ GraphQL æ—¶å°±æ— æ³•æ­£å¸¸å·¥ä½œäº†ã€‚

Prisma æä¾›äº† GraphQL æŸ¥è¯¢å¼•æ“æ¥ä¸“é—¨å¤„ç† resolve è¯·æ±‚ï¼Œä»è€Œè§£å†³äº†è¿™ä¸ªé—®é¢˜ã€‚å½“ä½¿ç”¨ Prisma çš„æ—¶å€™ï¼Œè§£æå™¨çš„è¿è¡Œï¼Œå…¶å®åªæ˜¯å°†ä¼ å…¥çš„æŸ¥è¯¢å§”æ‰˜ç»™åº•å±‚çš„ Prisma å¼•æ“ã€‚å¤šäºäº† Prisma bindingsï¼Œè¯·æ±‚å§”æ‰˜å°†ä¼šæ˜¯ä¸€ä¸ªå¾ˆç®€å•çš„è¿‡ç¨‹ï¼Œæ‰€æœ‰çš„ resolver éƒ½å¯ä»¥ç”¨ä¸€è¡Œä»£ç å°±å®ç°ã€‚

> Prisma binding åŸºäº schema çš„å§”æ‰˜å’Œæ‹¼æ¥çš„æ€æƒ³ã€‚æœ¬æ•™ç¨‹ä¸­ï¼Œæˆ‘ä»¬å°†ä¸ä¼šæ·±å…¥åˆ°è¿™äº›æŠ€æœ¯çš„ç»†èŠ‚ï¼Œå¦‚æœä½ æƒ³äº†è§£æ›´å¤šï¼Œå¯ä»¥çœ‹çœ‹ä¸‹é¢è¿™ä¸¤ç¯‡æ–‡ç« ï¼š
> [GraphQL Schema Stitching explained: Schema Delegation](https://blog.graph.cool/graphql-schema-stitching-explained-schema-delegation-4c6caf468405)
> [Reusing & Composing GraphQL APIs with GraphQL Bindings](https://blog.graph.cool/reusing-composing-graphql-apis-with-graphql-bindings-80a4aa37cff5)

## ç»“æ„

ä¸‹é¢è¿™ä¸ªå›¾å°±æ˜¯ä½¿ç”¨ Prisma æ„å»º GraphQL æœåŠ¡æ—¶çš„ç»“æ„ã€‚

![graphql9](../imgs/graphqlpic9.png)

çŸ¥é“è¿™ä¸ªç»“æ„éå¸¸é‡è¦ï¼Œåœ¨è¿™ä¸ªç»“æ„ä¸­ä½ éœ€è¦å¤„ç†ä¸¤ä¸ª(!) GraphQL API å±‚ã€‚

### åº”ç”¨å±‚

ç¬¬ä¸€ä¸ª GraphQL API å°±æ˜¯åœ¨å‰å‡ ç¯‡æ•™ç¨‹ä¸­ä½ å·²ç»å¼€å§‹æ­å»ºçš„éƒ¨åˆ†ã€‚è¿™ä¸ªæ˜¯åº”ç”¨å±‚çš„ GraphQL APIã€‚å®ƒå®šä¹‰äº†å®¢æˆ·ç«¯åº”ç”¨å°†è¦è®¿é—®çš„ APIã€‚åœ¨è¿™ä¸€å±‚ä½ å¯ä»¥å®ç°äº‹ç‰©é€»è¾‘ã€å·¥ä½œæµã€è®¤è¯å’Œæˆæƒæˆ–è€…å’Œç¬¬ä¸‰æ–¹æœåŠ¡æ•´åˆã€‚åº”ç”¨å±‚çš„ API åœ¨ src/schema.graphql æ–‡ä»¶ä¸­ç”± GraphQL schema å®šä¹‰ - ä»ç°åœ¨èµ·æˆ‘ä»¬å°±å°†è¿™ä¸ª schema ç§°ä¸º**åº”ç”¨ schema**ã€‚

### æ•°æ®åº“å±‚

ç¬¬äºŒä¸ª GraphQL API æ˜¯ Prisma æä¾›çš„ï¼Œå®ƒæä¾›äº†æ•°æ®åº“å±‚ã€‚è¿™ä¸ªåŸºæœ¬ä¸Šå°±æ˜¯ä¸€ä¸ªåŸºäº GraphQL çš„æ•°æ®åº“æ¥å£ï¼Œå¸®ä½ çœå»äº†å†™ SQL çš„ç¹çã€‚é‚£ä¹ˆï¼Œè¿™ä¸ª GraphQL API é•¿ä»€ä¹ˆæ ·å­å‘¢ï¼Ÿ

Prisma API æ˜¯ä¸€ä¸ªé•œåƒæ•°æ®åº“ APIï¼Œæ‰€ä»¥å®ƒå…è®¸ä½ å¯¹ç‰¹å®šæ•°æ®ç±»å‹è¿›è¡Œå¢åˆ æ”¹æŸ¥çš„æ“ä½œã€‚ä»€ä¹ˆæ˜¯æ•°æ®ç±»å‹ï¼Ÿè¿™å°†å–å†³äºä½  - ä½ å¯ä»¥ç”¨ä½ å¾ˆç†Ÿæ‚‰çš„ SDL å®šä¹‰è¿™äº›æ•°æ®ç±»å‹ã€‚åé¢ä½ å°†ä¼šå­¦ä¹ å®ƒæ˜¯å¦‚ä½•å·¥ä½œçš„ã€‚

é€šå¸¸æƒ…å†µä¸‹ï¼Œè¿™äº›æ•°æ®ç±»å‹ä»£è¡¨äº†ä½ åº”ç”¨çš„å®ä½“ã€‚æ¯”å¦‚ï¼Œä½ æ­£åœ¨æ­å»ºä¸€ä¸ªæ±½è½¦ç»é”€å•†è½¯ä»¶ï¼Œé‚£ä½ å°±å¯èƒ½ä¼šæœ‰ Car, CarDealer, Customer è¿™æ ·çš„æ•°æ®ç±»å‹ã€‚æ‰€æœ‰è¿™æ ·çš„æ•°æ®ç±»å‹çš„é›†åˆå°±æ˜¯ä½ çš„æ•°æ®æ¨¡å‹ã€‚

ä¸€æ—¦ä½ çš„æ•°æ®æ¨¡å‹å®šä¹‰äº†ï¼ŒPrisma å°±ä¼šæŠŠå®ƒç¿»è¯‘ä¸ºä¸€ä¸ªç›¸åº”çš„æ•°æ®åº“ schemaï¼Œç„¶ååŸºäºæ­¤é…ç½®å¥½æ•°æ®åº“ã€‚å½“ä½ æ¥ä¸‹æ¥å‘ Prisma GraphQL API å‘é€ queries å’Œ mutations æ—¶ï¼Œå®ƒå°±ä¼šè‡ªåŠ¨çš„æŠŠè¿™äº›ç¿»è¯‘ä¸ºæ•°æ®åº“æ“ä½œç„¶åè¿è¡Œè¿™äº›æ“ä½œã€‚ç®€å•æ˜äº†å“ˆï½

ä¹‹å‰æˆ‘ä»¬å·²ç»å­¦ä¹ äº†ï¼Œæ‰€æœ‰çš„ GraphQL APIs éƒ½æœ‰ä¸€ä¸ª GraphQL schema æ¥æ”¯æŒã€‚æ‰€ä»¥è°æ¥ä¸º Prisma GraphQL API æä¾› schema å‘¢ï¼Ÿç­”æ¡ˆæ˜¯ï¼Œå®ƒå°†ä¼šåŸºäºä½ æä¾›çš„æ•°æ®æ¨¡å‹è¢«è‡ªåŠ¨ç”Ÿæˆã€‚æ‰€ä»¥ï¼Œè¿™ä¸ª schema ä¹Ÿè¢«ç§°ä¸º Prisma database schemaã€‚

è¿™æ˜¯ä¸€ä¸ªä¾‹å­ï¼Œè€ƒè™‘ä¸€ä¸ªå¾ˆç®€å•çš„æ•°æ®æ¨¡å‹ï¼Œå®ƒæœ‰ä¸€ä¸ª User ç±»å‹ï¼š

```js
type User {
  id: ID! @unique
  name: String!
}
```

> å…ˆåˆ«ç®¡ @unique æ ‡è¯†ï¼Œæˆ‘ä»¬åç»­ä¼šè¯´ã€‚

åŸºäºè¿™ä¸ªæ•°æ®æ¨¡å‹ï¼ŒPrisma å°†ä¼šç”Ÿæˆä¸€ä¸ªåƒè¿™æ ·çš„ GraphQL schemaï¼š

```js
type Query {
  users(where: UserWhereInput, orderBy: UserOrderByInput, skip: Int, after: String, before: String, first: Int, last: Int): [User]!
  user(where: UserWhereUniqueInput!): User
}

type Mutation {
  createUser(data: UserCreateInput!): User!
  updateUser(data: UserUpdateInput!, where: UserWhereUniqueInput!): User
  deleteUser(where: UserWhereUniqueInput!): User
}

type Subscription {
  user(where: UserSubscriptionWhereInput): UserSubscriptionPayload
}
```

å®é™…ä¸Šçš„ schema è¿˜è¦æ›´å¤§ä¸€äº› - è¿™é‡Œä¸ºäº†ç®€å•æœŸé—´æˆ‘ä»¬å°±åªåŒ…å«äº†ä¸‰ä¸ª root ç±»å‹ä»¥åŠç®€å•çš„å¢åˆ æ”¹æŸ¥æ“ä½œã€‚ä½†æ˜¯å…¶å® API è¿˜å…è®¸å…¶ä»–å¾ˆå¤šæ“ä½œï¼ˆæ¯”å¦‚æ‰¹é‡æ›´æ–°å’Œåˆ é™¤ï¼‰ã€‚å¦‚æœä½ æ„Ÿå…´è¶£ï¼Œå¯ä»¥æŸ¥çœ‹[è¿™é‡Œ](https://gist.github.com/gc-codesnippets/3f4178ad93c51d03195c92ce119d444c)ã€‚

### ä¸ºä»€ä¹ˆä¸ç›´æ¥ä½¿ç”¨ Prisma GraphQL APIï¼Ÿ

Prisma å…¶å®å°±æ˜¯ä¸€ä¸ªæ•°æ®åº“æ¥å£ã€‚å¦‚æœä½ ç›´æ¥ç”¨å‰ç«¯æˆ–è€…ç§»åŠ¨ç«¯è¿æ¥ Prismaï¼Œé‚£å°±åƒæ˜¯ç›´æ¥è¿æ¥æ•°æ®åº“äº†ã€‚

åœ¨æå°‘çš„æƒ…å†µä¸‹ï¼Œä¹Ÿè®¸è¿™ä¹Ÿæ˜¯ä¸ªé€‰æ‹©ï¼šä½†æ˜¯å¤§å¤šæ•°çš„åº”ç”¨è¿˜æ˜¯å¿…é¡»è¦ä¸€ä¸ªä¸ä»…ä»…åŒ…å«å¢åˆ æ”¹æŸ¥çš„é™„åŠ çš„é€»è¾‘å±‚ï¼ˆæ•°æ®æ ¡éªŒã€æƒé™ã€ç¬¬ä¸‰æ–¹æœåŠ¡æ•´åˆç­‰ç­‰éƒ½éœ€è¦åœ¨è¿™ä¸€å±‚å¤„ç†ï¼‰ã€‚

å°† Prisma æ¥å£ç›´æ¥æš´éœ²ç»™å®¢æˆ·ç«¯çš„å¦ä¸€ä¸ªæ½œåœ¨é—®é¢˜å°±æ˜¯å®‰å…¨æ€§ã€‚GraphQL çš„å·¥ä½œæ–¹å¼å°±æ˜¯ï¼Œè°èƒ½å¤Ÿè®¿é—® GraphQL æ¥å£ç»ˆç«¯ï¼Œè°å°±èƒ½å¤Ÿä»è¿™ä¸ªç«¯å£è¿½æº¯æ•´ä¸ª schemaã€‚è¿™è¢«ç§°ä¸ºï¼šå†…çœã€‚å¦‚æœä½ çš„å®¢æˆ·ç«¯ç›´æ¥å’Œ Prisma è¿æ¥ï¼Œé‚£ä¹ˆé€šè¿‡æ£€æŸ¥ç½‘ç»œè¯·æ±‚å°±èƒ½å¾ˆç®€å•çš„è·å–åˆ° Prisma API çš„ç«¯å£ï¼Œç„¶åæ‰€æœ‰ç”¨æˆ·éƒ½èƒ½çœ‹åˆ°ä½ æ•°æ®åº“çš„æ‰€æœ‰ schema äº†ã€‚

> æœ€è¿‘ï¼Œå…³äºæ˜¯å¦åº”è¯¥é™åˆ¶è‡ªçœåŠŸèƒ½ä¸€ç›´æœ‰äº‰è®ºï¼Œä½†æ˜¯ç›®å‰ä¸ºæ­¢è¿˜æ²¡æœ‰ä»€ä¹ˆæ–¹æ¡ˆã€‚

## åŸºäºä¸€ä¸ªå·²è¿æ¥çš„æ•°æ®åº“ï¼Œå»ºç«‹ Prisma æœåŠ¡

åœ¨è¿™éƒ¨åˆ†æ•™ç¨‹ä¸­ï¼Œä½ å°†ä¼šä»å¤´å¼€å§‹å¹¶æ­å»ºå¥½ä¸€åˆ‡ï¼å…³äº Prisma æ•°æ®åº“æœåŠ¡ï¼Œä½ å°†ä»å¯èƒ½çš„æœ€ç®€å•çš„è®¾ç½®å¼€å§‹ã€‚

é¦–å…ˆï¼Œéœ€è¦åˆ›å»ºä¸¤ä¸ªæ–‡ä»¶ï¼Œè¿™ä¸¤ä¸ªæ–‡ä»¶æ”¾åœ¨ä¸€ä¸ªæ–°çš„ç›®å½•ä¸‹ï¼Œç›®å½•çš„åå­—æ˜¯ databaseã€‚

è¿™ä¸¤ä¸ªæ–‡ä»¶çš„åå­—æ˜¯ prisma.yml å’Œ datamodel.graphqlï¼Œåˆ›å»ºçš„æ–¹å¼å°±æ˜¯åœ¨å‘½ä»¤è¡Œæ‰§è¡Œå¦‚ä¸‹ä»£ç ï¼š

```
mkdir database
touch database/prisma.yml
touch database/datamodel.graphql
```

prisma.yml æ˜¯ä½ çš„ Prisma æ•°æ®åº“æœåŠ¡çš„ä¸»è¦é…ç½®æ–‡ä»¶ã€‚
å¦ä¸€æ–¹é¢ï¼Œdatamodel.graphql åˆ™åŒ…å«äº†æ•°æ®æ¨¡å‹çš„å®šä¹‰ï¼Œå®ƒå°†ä¼šæ˜¯ Prisma ç”Ÿæˆ GraphQL CRUD API çš„åŸºç¡€ã€‚

ç›®å‰ä½ç½®ï¼Œä½ çš„ Hacker News app çš„æ•°æ®æ¨¡å‹å¯èƒ½åªåŒ…å«ä¸€ç§æ•°æ®ç±»å‹ï¼šLinkã€‚äº‹å®ä¸Šï¼Œä½ å¯ä»¥ç›´æ¥æŠŠ Link çš„å®šä¹‰ä» schema.graphql æ‹·è´åˆ° datamodel.graphqlã€‚

æ‰“å¼€ datamodel.graphql å¹¶æ·»åŠ å¦‚ä¸‹ä»£ç ï¼š

```
type Link {
  id: ID! @unique
  createdAt: DateTime!
  description: String!
  url: String!
}
```

ç›¸æ¯”äºä¹‹å‰ schema.graphql ä¸­çš„ Linkï¼Œè¿™é‡Œçš„ Link æœ‰ä¸¤ä¸ªä¸»è¦çš„åŒºåˆ«ã€‚

é¦–å…ˆï¼Œåœ¨ id: ID! çš„åé¢æ·»åŠ äº† @unique æ ‡è¯†ã€‚è¿™ä¸ªæ ‡è¯†å‘Šè¯‰ Prismaï¼šä»»ä½•ä¸¤ä¸ªæ•°æ®åº“ä¸­çš„ Link å…ƒç´ çš„è¿™ä¸ªå­—æ®µéƒ½ä¸èƒ½é‡å¤ã€‚å®é™…ä¸Šï¼Œid: ID! åœ¨ Prisma æ•°æ®æ¨¡å‹ä¸­æ˜¯ä¸€ä¸ªå¾ˆç‰¹æ®Šçš„å­—æ®µï¼Œå› ä¸º Prisma å°†ä¼šè‡ªåŠ¨çš„ç”Ÿæˆå…¨å±€å”¯ä¸€ ID å¹¶æä¾›ç»™æœ‰è¿™ä¸ªå­—æ®µçš„æ•°æ®ã€‚

å…¶æ¬¡ï¼Œæˆ‘ä»¬è¿˜æ·»åŠ äº†ä¸€ä¸ªæ–°çš„å­—æ®µï¼šcreatedAt: DateTime!ã€‚è¿™ä¸ªå­—æ®µä¹Ÿæ˜¯ Prisma è´Ÿè´£ç®¡ç†çš„ï¼Œå¹¶ä¸”åœ¨ API ä¸­æ˜¯åªè¯»çš„ã€‚å®ƒå­˜å‚¨äº†æ¯ä¸ª Link è¢«åˆ›å»ºçš„æ—¶é—´ã€‚æ³¨æ„ï¼ŒPrisma è¿˜æä¾›å¦ä¸€ä¸ªç›¸ä¼¼çš„å­—æ®µï¼ŒupdatedAt: DateTimeï¼šå®ƒå­˜å‚¨äº† Link çš„æœ€åæ›´æ–°æ—¶é—´ã€‚

ç°åœ¨ï¼Œæˆ‘ä»¬æ¥çœ‹çœ‹ä½ éœ€è¦å¦‚ä½•å¤„ç† prisma.ymlï¼š

æ·»åŠ å¦‚ä¸‹çš„å†…å®¹ï¼š

```
# The service name, this will be part of the endpoint of the Prisma API
service: hackernews-node

# The deployment stage, this will also be part of the API endpoint
stage: dev

# Points to the file that holds your data model
datamodel: datamodel.graphql

# You can only access the API when providing JWTs that are signed with this secret
secret: mysecret123
```

æƒ³è¦å­¦ä¹ æ›´å¤šå…³äº prisma.yml çš„ç»“æ„ï¼Œå¯ä»¥æŸ¥çœ‹[æ–‡æ¡£](https://www.prisma.io/docs/reference/service-configuration/prisma.yml/yaml-structure-ufeshusai8/)

è¿™é‡Œæ˜¯å…³äºä¸Šé¢è¿™ä¸ªæ–‡ä»¶çš„å¿«é€Ÿè§£æï¼š

* serviceï¼šé€‰ä¸€ä¸ªä½ è®¤ä¸ºåˆé€‚çš„æœåŠ¡åã€‚

* stageï¼šç”¨äºåŒºåˆ†æœåŠ¡ä¸åŒçš„éƒ¨ç½²é˜¶æ®µï¼Œå®ƒçš„å€¼å¯ä»¥æ˜¯ä»»æ„å­—ç¬¦ä¸²ï¼Œä¸è¿‡ä¸€èˆ¬éƒ½æ˜¯ï¼šdevï¼Œstaging æˆ–è€… prodã€‚

* secretï¼šä¸ºäº†ä¿æŠ¤ä½ çš„ Prisma æœåŠ¡ï¼Œè¦æ±‚å¯¹ Prisma å‘èµ·çš„è¯·æ±‚éƒ½å¿…é¡»éœ€è¦åšè®¤è¯ã€‚è¿™ä¸ª secret ç”¨æ¥ç­¾ç½² JWTsï¼Œå®ƒéœ€è¦è¢«åŒ…å«åœ¨å‘ Prisma å‘èµ·çš„ HTTP è¯·æ±‚çš„ Authorization å¤´éƒ¨ã€‚[é˜…è¯»è¿™é‡Œ](https://www.prisma.io/docs/reference/prisma-api/concepts-utee3eiquo/#authentication)äº†è§£æ›´å¤šã€‚

ä¸‹ä¸€æ­¥ï¼Œå°±æ˜¯å®‰è£… Prisma CLIï¼Œç”¨äºç®¡ç† Prisma æœåŠ¡ã€‚

åœ¨ç»ˆç«¯è¿è¡Œå¦‚ä¸‹å‘½ä»¤

```
yarn global add prisma@1.6.3
```

å¥½äº†ï½ç°åœ¨ä½ ç»ˆäºå‡†å¤‡å¥½å¯ä»¥éƒ¨ç½²ä½ çš„ Prisma æœåŠ¡äº†ï¼ŒåŒæ—¶ä½ å°†è¿æ¥åˆ°æ•°æ®åº“ã€‚

åœ¨ database ç›®å½•ä¸‹è¿è¡Œ prisma deployã€‚

å‘½ä»¤å°†ä¼šæŒ‡ç¤ºä½ é€‰æ‹©ä¸€ä¸ª cluster ç”¨äºéƒ¨ç½² Prisma æœåŠ¡ã€‚æœ¬æ•™ç¨‹ä¸­ä½ å°†ä¼šä½¿ç”¨ development clusterï¼Œå®ƒæ˜¯å®Œå…¨å…è´¹çš„ã€‚

> Prisma æ˜¯å¼€æºçš„ï¼Œå®ƒåŸºäº Dockerï¼Œæ„å‘³ç€ä½ å¯ä»¥éƒ¨ç½²åœ¨ä½ é€‰æ‹©çš„ä»»ä½•ä¸€ä¸ªäº‘æœåŠ¡ä¸Šã€‚å¦‚æœä½ ä¸æƒ³è¦å¤„ç† DevOps å’Œ Docker çš„æ‰‹å·¥é…ç½®ï¼Œä½ ä¹Ÿå¯ä»¥ä½¿ç”¨ Prisma Cloud æ¥è¿è¡Œä¸€ä¸ªç§äººçš„ cluster ç”¨äºéƒ¨ç½²æœåŠ¡ã€‚å…·ä½“å¯ä»¥æŸ¥çœ‹è¿™æ®µ[è§†é¢‘](https://www.youtube.com/watch?v=jELE4KXJPn4)ã€‚

åœ¨ CLI çš„æŒ‡ç¤ºä¸­é€‰æ‹©ä»»ä½•ä¸€ä¸ª Development cluster é€‰é¡¹ç„¶åæŒ‰å›è½¦ï¼ˆå¦‚æœä½ æœ¬åœ°æœ‰å®‰è£… Dockerï¼Œä½ ä¹Ÿå¯ä»¥åœ¨æœ¬åœ°éƒ¨ç½²ï¼‰ã€‚

ä¸€æ—¦å‘½ä»¤è¿è¡Œç»“æŸï¼ŒCLI ä¼šè¾“å‡º Prisma GraphQL API çš„ç«¯å£ï¼Œå®ƒå·®ä¸å¤šä¼šåƒè¿™æ ·ï¼šhttps://eu1.prisma.sh/public-graytracker-771/hackernews-node/dev

URL çš„ç»„æˆï¼š

* eu1.prisma.shï¼šcluster çš„åŸŸå
* public-graytracker-771ï¼šéšæœºç”Ÿæˆçš„æœåŠ¡ ID
* hackernews-nodeï¼šæ¥è‡ª prisma.yml çš„æœåŠ¡å
* devï¼šæ¥è‡ª prisma.yml çš„å¼€å‘é˜¶æ®µï¼ˆstageï¼‰

æ³¨æ„åˆ°ï¼ŒCLI ä¹Ÿåœ¨ prisma.yml ä¸­æ·»åŠ äº†ä¸€ä¸ª cluster å±æ€§ã€‚å› æ­¤åœ¨ä¹‹åçš„éƒ¨ç½²ä¸­ï¼Œä½ å°±ä¸ä¼šå†æ¬¡è¢«æç¤ºç¡®è®¤æœåŠ¡éƒ¨ç½²çš„åœ°å€äº† - CLI å°†ä¼šä» prisma.yml ä¸­è¯»å–è¿™ä¸ªåœ°å€ã€‚ä½†æ˜¯å¦‚æœä½ æŠŠè¿™ä¸ªå±æ€§ç§»é™¤ï¼ŒCLI å°±åˆä¼šé‡æ–°æ˜¾ç¤ºæç¤ºã€‚

## æ¢ç´¢ Prisma æœåŠ¡

ç‚¹å‡»æ‰“å¼€åˆšæ‰ CLI è¾“å‡ºçš„ URLï¼Œç»§ç»­ Prisma æ•°æ®åº“ API çš„æ¢ç´¢ã€‚

> æ³¨æ„ï¼šå¦‚æœä½ ä¸å°å¿ƒä¸¢å¤±äº†ç«¯å£åœ°å€ï¼Œä½ å¯ä»¥åœ¨ç»ˆç«¯è¿è¡Œ prisma info æ¥é‡æ–°è·å– URLã€‚

ä½†æ˜¯ã€ç‚¹å‡» URL åä½ å°†çœ‹åˆ°è¿™æ ·ä¸€æ®µæŠ¥é”™ä¿¡æ¯ï¼š

```js
{
  "errors": [
    {
      "message": " Your token is invalid. It might have expired or you might be using a token from a different project.",
      "code": 3015,
      "requestId": "api:api:cjfcbpal10t6w0b91idqif941"
    }
  ]
}
```

è¿˜è®°å¾—æˆ‘ä»¬ä¹‹å‰è¯´è¿‡ï¼Œä½ çš„ Prisma API ä¼šè¢«æ¥è‡ª prisma.yml çš„å¯†ç ä¿æŠ¤å˜›ï¼Ÿè¿™å°±æ˜¯ä¸ºä»€ä¹ˆè¿™é‡Œä¼šæŠ¥é”™ï¼šPlayground è¯•å›¾ä»ç«¯å£åŠ è½½ GraphQL schemaï¼Œä½†æ˜¯è¯·æ±‚æ²¡æœ‰è¢«æˆæƒã€‚è®©æˆ‘ä»¬ç¨ä½œä¿®æ”¹ã€‚

åœ¨ database ç›®å½•ä¸‹ï¼Œè¿è¡Œå¦‚ä¸‹ä»£ç æ¥ç”Ÿæˆä¸€ä¸ªæˆæƒ tokenï¼Œå®ƒæœ‰ prisma.yml å¯†ç çš„ç­¾åã€‚

```
prisma token
```

æ‹·è´ CLI è¾“å‡ºçš„è¿™ä¸ª tokenï¼Œç„¶åç”¨å®ƒæ¥åœ¨ Playground ä¸­é…ç½® HTTP çš„å¤´éƒ¨ä¿¡æ¯ã€‚ä½ ä¹Ÿå¯ä»¥ç”¨ Playground å·¦ä¸‹è§’çš„ HTTP HEADERS é¢æ¿æ¥å®Œæˆ -- æ³¨æ„ï¼Œä½ éœ€è¦å°† `__TOKEN__` å ä½ç¬¦ç”¨åˆšæ‰ç”Ÿæˆçš„ token æ›¿æ¢æ‰ã€‚

```
{
  "Authorization": "Bearer __TOKEN__"
}
```

å‡ ç§’é’Ÿåï¼ŒPlayground å°±å°†ä¼šåŠ è½½ schemaï¼Œä½ å°±èƒ½å¤Ÿå‘ Prisma API å‘é€æˆæƒè¯·æ±‚äº†ã€‚æ‰“å¼€æ–‡æ¡£ï¼Œå°±å¯ä»¥çœ‹åˆ°å¯ç”¨çš„ API æ“ä½œäº†ã€‚

å¦‚æœä½ è¿˜æƒ³ç»§ç»­æ¢ç´¢ï¼Œè¿˜å¯ä»¥å‘é€å¦‚ä¸‹çš„ mutation å’Œ query æ¥åˆ›å»ºä¸€ä¸ªæ–°çš„ linkã€å¹¶æŸ¥çœ‹æ‰€æœ‰ link çš„åˆ—è¡¨ï¼š

åˆ›å»ºæ–°çš„ Linkï¼š

```js
mutation {
  createLink(data: {
    url: "www.prisma.io"
    description: "Prisma turns your database into a GraphQL API"
  }) {
    id
  }
}
```

åŠ è½½æ‰€æœ‰ link å…ƒç´ ï¼š

```js
query {
  links {
    id
    url
    description
  }
}
```

[self Proofreading +1]
